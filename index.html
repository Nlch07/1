<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Firebase –ß–∞—Ç</title>
<style>
    body { font-family: Arial; background: #eef1f5; padding: 20px; }
    #chat { max-width: 550px; margin: auto; }
    .msg { background: white; padding: 10px 15px; margin: 10px 0; border-radius: 10px; position: relative; }
    .me { background: #d4f8d4; }
    .nick { font-weight: bold; }
    .time { font-size: 12px; color: gray; float: right; margin-left: 10px; }
    .status { font-size: 12px; color: #4CAF50; margin-top: 5px; }
    #name, #message { width: 100%; padding: 10px; margin: 5px 0; }
    button { width: 100%; padding: 10px; background: #4CAF50; border: none; color: white; cursor: pointer; }
    button:hover { background: #45a049; }
</style>
</head>
<body>

<div id="chat">
    <h2>üî• –£—Å–ª–æ–∂–Ω—ë–Ω–Ω—ã–π Firebase –ß–∞—Ç</h2>

    <input id="name" type="text" placeholder="–í–∞—à–µ –∏–º—è">
    <textarea id="message" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ"></textarea>
    <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>

    <h3>–°–æ–æ–±—â–µ–Ω–∏—è:</h3>
    <div id="messages"></div>
</div>


<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCysKcXFVoqWDIQzkdObB-9sgm54cRGyp0",
        authDomain: "test3-88cee.firebaseapp.com",
        databaseURL: "https://test3-88cee-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "test3-88cee",
        storageBucket: "test3-88cee.firebasestorage.app",
        messagingSenderId: "469479851370",
        appId: "1:469479851370:web:915e95767b012c281e1113"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const messagesRef = ref(db, "messages");

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    const deviceId = "dev_" + Math.random().toString(36).substr(2, 9);

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    window.sendMessage = function () {
        const name = document.getElementById("name").value.trim();
        const message = document.getElementById("message").value.trim();

        if (!name || !message) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!");

        const msgData = {
            name: name,
            text: message,
            time: Date.now(),
            from: deviceId,
            status: "sent" // –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –≤ Firebase
        push(messagesRef, msgData);

        document.getElementById("message").value = "";
    };

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    const messagesDiv = document.getElementById("messages");

    onChildAdded(messagesRef, snapshot => {
        const msg = snapshot.val();

        const isMe = msg.from === deviceId;

        let div = document.createElement("div");
        div.className = "msg" + (isMe ? " me" : "");

        // –≤—Ä–µ–º—è —Ñ–æ—Ä–º–∏—Ä—É–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω–æ
        let date = new Date(msg.time);
        let hh = date.getHours().toString().padStart(2, "0");
        let mm = date.getMinutes().toString().padStart(2, "0");

        let status = "";
        if (isMe) status = `<div class="status">‚úì‚úì –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</div>`;

        div.innerHTML = `
            <div class="nick">${msg.name}</div>
            ${msg.text}
            <span class="time">${hh}:${mm}</span>
            ${status}
        `;

        messagesDiv.appendChild(div);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

</script>

</body>
</html>
